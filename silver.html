<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Silver and gold coin values</title>
        <style>
            .highlight{
                background-color: blue;
            }
            .hidden{
                display: none;
            }
            .darkmode{
                background-color: black;
                color: white;
            }
            .toggle-switch {
                position: relative;
                display: inline-block;
                width: 50px;
                height: 24px;
            }

            .toggle-switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }

            .slider {
                position: absolute;
                cursor: pointer;
                background-color: #ccc;
                border-radius: 24px;
                width: 100%;
                height: 100%;
                transition: background-color 0.3s;
            }

            .slider::before {
                content: "";
                position: absolute;
                height: 20px;
                width: 20px;
                left: 4px;
                bottom: 2px;
                background-color: white;
                border-radius: 50%;
                transition: transform 0.3s;
            }

                    /* On state */
                .toggle-switch input:checked + .slider {
                    background-color: #4caf50;
                }

                .toggle-switch input:checked + .slider::before {
                    transform: translateX(26px);
                }
        </style>
    </head>
    <body>
        <div id="header">
            <h2>Live Silver and Gold coin values</h2>
        </div>
        <script>
            let timer = 0;
            let timerInterval = 0;
            let svAlertMin = localStorage.getItem('svAlertMin') != null? localStorage.getItem('svAlertMin'):-1;
            let svAlertMax = localStorage.getItem('svAlertMax') != null? localStorage.getItem('svAlertMax'):1000000;
            function connect() {
                
            //connect to API
            fetch('https://api.gold-api.com/price/XAG')
            .then(response => {
                if (!response.ok) {
                    console.log(`HTTP error! status: ${response.status}`);
                }
                // Check if response has content
                return response.text(); // Get as text first
                })
            .then(text => {
            if (!text) {
            console.error('Empty response received');
            return;
            }
            data = JSON.parse(text); // Parse manually
            manage(data);
            })
            .catch(error => console.error('Fetch error:', error));
            function inform() {
                document.getElementById('inform-04').open = true;
            }
            function dismiss() {
                document.getElementById('inform-04').open = false;
            }
            function manage(d) {
                data = d;
            }
            fetch('https://api.gold-api.com/price/XAU')
            .then(response => {
                if (!response.ok) {
                    console.log(`HTTP error! status: ${response.status}`);
                }
                // Check if response has content
                return response.text(); // Get as text first
                })
            .then(text => {
            if (!text) {
            console.error('Empty response received');
            return;
            }
            gold = JSON.parse(text); // Parse manually
            manageGold(gold);
            })
            .catch(error => console.error('Fetch error:', error));
        }
            function manageGold(d) {
                gold = d;
                //stop timer if any
                if (timerInterval != 0){
                    clearInterval(timerInterval);
                    timerInterval = 0;
                }
                //start timer
                timer = 0;
                timerInterval =  setInterval(()=>timer++, 1000)
            }
            connect();
        </script>
        <div id="bodycontent">
            Prices Last updated <span id="time"></span> seconds ago.
            <script>
            setInterval(() => {

                    let sv_updated = timer;
                    if (timer > 29){
                        connect();
                    }
                    document.getElementById('time').innerText = sv_updated;
                }, 1000);
            </script>
            <h2>Silver</h2>
            <p>Current silver spot price: $<span id="svspot"></span>.</p>
            <script>
                let storedspot;
            setInterval(() => {
                    document.getElementById('svspot').classList.remove('highlight')
                    let sv_spot = Math.floor(data.price * 100) /100;
                    if (storedspot != sv_spot){
                        document.getElementById('svspot').classList.add('highlight')
                    }
                    document.getElementById('svspot').innerText = sv_spot;
                    storedspot = sv_spot;
                }, 1000);
            </script>
            <details><summary>U.S Circulating and Commemorative Silver coins</summary>
            <p>A silver half dime, which contains 0.04 ounces of silver, is worth $<span id="silver-hdime"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_dime = Math.round(0.04 * data.price *100) / 100;
                document.getElementById('silver-hdime').innerText = sv_dime;
                }, 1000);
            </script>
            <p>A silver dime, which contains 0.08 ounces of silver, is worth $<span id="silver-dime"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_dime = Math.round(0.08 * data.price *100) / 100;
                document.getElementById('silver-dime').innerText = sv_dime;
                }, 1000);
            </script>
            <p>A silver quarter, which contains 0.18 ounces of silver, is worth $<span id="silver-qtr"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_qtr = Math.round(0.18 * data.price *100) / 100;
                    document.getElementById('silver-qtr').innerText = sv_qtr;
                }, 1000);
            </script>
            <p>A silver 90% half-dollar, which contains 0.36 ounces of silver, is worth $<span id="silver-half"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_half = Math.round(0.36 * data.price *100) / 100;
                    document.getElementById('silver-half').innerText = sv_half;
                }, 1000);
            </script>
            <p>A silver clad half-dollar (40%), which contains 0.14792 ounces of silver, is worth $<span id="sv-half"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_half = Math.round(0.14792 * data.price *100) / 100;
                    document.getElementById('sv-half').innerText = sv_half;
                }, 1000);
            </script>
            <p>A silver dollar, which contains 0.77 ounces of silver, is worth $<span id="silver-dollar"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_doll = Math.round(0.77 * data.price *100) / 100;
                    document.getElementById('silver-dollar').innerText = sv_doll;
                }, 1000);
            </script>
            </details>
            <details id="sv-bullion">
                <summary>Silver Bullion</summary>
            <p>A 2oz silver coin is worth $<span id="silver-two"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_doll = Math.round(2 * data.price *100) / 100;
                    document.getElementById('silver-two').innerText = sv_doll;
                }, 1000);
            </script>
            <p>A 5oz silver coin is worth $<span id="silver-five"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_doll = Math.round(5 * data.price *100) / 100;
                    document.getElementById('silver-five').innerText = sv_doll;
                }, 1000);
            </script>
            </details>
            <h1>Gold</h1>
            <p>Current gold spot price: $<span id="goldspot"></span>.</p>
            <script>
            setInterval(() => {
                    let gd_spot = Math.floor(gold.price * 100) / 100;
                document.getElementById('goldspot').innerText = gd_spot;
                }, 1000);
            </script>
            <details id="gd-bullion"><summary>Maple leaf gold</summary>
            <p>A gold 1/10oz maple leaf is worth $<span id="0.1"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_doll = Math.round(0.1 * gold.price *100) / 100;
                    document.getElementById('0.1').innerText = sv_doll;
                }, 1000);
            </script>
            <p>A gold 1/4 oz maple leaf is worth $<span id="0.25"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_doll = Math.round(0.25 * gold.price *100) / 100;
                    document.getElementById('0.25').innerText = sv_doll;
                }, 1000);
            </script>
            <p>A gold 1/2oz maple leaf is worth $<span id="0.5"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_doll = Math.round(0.5 * gold.price *100) / 100;
                    document.getElementById('0.5').innerText = sv_doll;
                }, 1000);
            </script>
            <p>A gold 1 oz maple leaf is worth $<span id="1"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_doll = Math.round(gold.price *100) / 100;
                    document.getElementById('1').innerText = sv_doll;
                }, 1000);
            </script>
            </details>
            
            <p>A gold $2 1/2 coin, which contains 0.14 ounces of gold, is worth $<span id="2.5"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_doll = Math.round(0.14 * gold.price *100) / 100;
                    document.getElementById('2.5').innerText = sv_doll;
                }, 1000);
            </script>
            <p>A gold $5 coin, which contains 0.28 ounces of gold, is worth $<span id="5"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_doll = Math.round(0.28 * gold.price *100) / 100;
                    document.getElementById('5').innerText = sv_doll;
                }, 1000);
            </script>
            <p>A gold $10 coin, which contains about 0.5 ounces of gold, is worth $<span id="10"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_doll = Math.round(0.5 * gold.price *100) / 100;
                    document.getElementById('10').innerText = sv_doll;
                }, 1000);
            </script>
            <p>A gold $20 coin, which contains 0.96 ounces of gold, is worth $<span id="20"></span>.</p>
            <script>
                setInterval(() => {
                    let sv_doll = Math.round(0.9675 * gold.price *100) / 100;
                    document.getElementById('20').innerText = sv_doll;
                }, 1000);
            </script>
            <button onclick="document.getElementById('control').classList.toggle('hidden')">...</button>
        <div class="hidden" id="control">
            Dark mode:
            <label class="toggle-switch" role="switch">
                <input type="checkbox" id="darkmode">
                <span class="slider"></span>
            </label>
            <h3>Alerts:</h3>
            <h4>Silver:</h4>
            <button onclick="setAlert(+5, 'silver');">+5%</button>
            <button onclick="setAlert(-5, 'silver');">-5%</button>
            <button onclick="setAlert(document.getElementById('input').value, 'silver');">Custom: <input type="number" id="input">%</button>
            <h4>Gold:</h4>
            <button onclick="setAlert(+5, 'gold');">+5%</button>
            <button onclick="setAlert(-5, 'gold');">-5%</button>
           <script>
            let openSection = ""; 
            setTimeout(() => {
                setInterval(() => {
                    if (document.getElementById('darkmode').checked == true){
                        document.body.classList.add('darkmode');
                    }else{
                        document.body.classList.remove('darkmode');
                    }
                    if (data.price >= svAlertMax){
                        alert('Silver spot price exceeded $'+svAlertMax + "/oz!")
                        svAlertMax = 1000000;
                        localStorage.setItem('svAlertMax', svAlertMax);
                    }
                    if (data.price <= svAlertMin){
                        alert('Silver spot price dropped below $'+svAlertMin + "/oz!")
                        svAlertMin = -1;
                        localStorage.setItem('svAlertMax', svAlertMax);
                    }
                }, 100);
                }, 1000);
                setInterval(() => {
                    if (document.getElementById('sv-bullion').open && document.getElementById("gd-bullion").open){
                        switch (openSection) {
                            case "sv-bullion"://if the silver section is open and the gold section is being opened
                                document.getElementById("sv-bullion").open = false;//close the silver section
                                break;
                            case "gd-bullion"://if the gold section is open and the silver section is being opened
                                document.getElementById("gd-bullion").open = false;//close the gold section
                                break;
                        }
                    }
                    if (document.getElementById('sv-bullion').open){
                        openSection = "sv-bullion";
                    }
                    if (document.getElementById('gd-bullion').open){
                        openSection = "gd-bullion";
                    }
                }, 100);
                function setAlert(percentabove=0, commodity="") {
                    switch (commodity) {
                        case "silver":
                            console.log('setting alert for silver:')
                            if (percentabove < 0){
                                console.log('Triggered when silver drops below', data.price * (1 + 0.01*percentabove))
                                svAlertMin = data.price * (1 + 0.01*percentabove);
                                localStorage.setItem('svAlertMin', svAlertMin)
                            }else{
                                console.log('Triggered when silver rises above', data.price * (1 + 0.01*percentabove))
                                svAlertMax = data.price * (1 + 0.01*percentabove);
                                localStorage.setItem('svAlertMax', svAlertMax);
                            }
                            break;
                    
                        case "gold":
                            //pass
                            break;
                        default:
                            console.log('Invalid parameter entered in `setAlert`: commodity');
                            break;
                    }
                }
           </script>   
        </div> 
        </div>
    </body>
</html>
